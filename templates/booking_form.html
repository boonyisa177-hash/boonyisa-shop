{% extends 'base.html' %}

{% block title %}{{ room.name }} - Boonyisa Hotel{% endblock %}

{% block content %}
	<main class="container my-5">
		<div class="row">
			<div class="col-lg-6 mx-auto">
				<div class="card p-4 mb-4">
					<h2 class="mb-4">üìù ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á: {{ room.name }}</h2>

					<div class="mb-4">
						<img src="{{ room.image_url or 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?auto=format&fit=crop&w=600&q=85' }}" alt="{{ room.name }}" class="img-fluid rounded mb-3" style="max-height:300px;object-fit:cover;width:100%">
						<div class="row text-muted">
							<div class="col-6">
								<p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> {{ room.room_type }}</p>
								<p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏:</strong> {{ room.capacity }} ‡∏Ñ‡∏ô</p>
							</div>
							<div class="col-6">
								<p><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏•‡∏∞:</strong> <span class="text-success">‡∏ø{{ '%.2f'|format(room.price_per_night) }}</span></p>
								<p><strong>‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å:</strong></p>
								<small>{{ room.amenities }}</small>
							</div>
						</div>
					</div>

					<form method="POST" action="{{ url_for('booking', room_id=room.id) }}">
						<div class="mb-3">
							<label for="check_in" class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</label>
							<input type="text" class="form-control date-picker" id="check_in" name="check_in" placeholder="dd/mm/yyyy" required>
						</div>

						<div class="mb-3">
							<label for="check_out" class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏û‡∏±‡∏Å</label>
							<input type="text" class="form-control date-picker" id="check_out" name="check_out" placeholder="dd/mm/yyyy" required>
						</div>

						<div class="mb-3">
							<label for="guests" class="form-label">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</label>
							<select class="form-control" id="guests" name="guests" required>
								<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</option>
								{% for i in range(1, room.capacity + 1) %}
								<option value="{{ i }}">{{ i }} ‡∏Ñ‡∏ô</option>
								{% endfor %}
							</select>
						</div>

						<div class="d-grid gap-2 d-md-flex">
							<button type="submit" class="btn btn-primary flex-grow-1">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
							<a href="{{ url_for('index') }}" class="btn btn-outline-secondary flex-grow-1">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
						</div>
					</form>
				</div>

					<div class="alert alert-info" role="alert">
					<strong>‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
				</div>

					<!-- Reviews -->
					<div class="card p-3 mt-3">
						<h5 class="mb-2">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</h5>
						{% set room_reviews = get_reviews(room.id) %}
						{% if room_reviews %}
							<ul class="list-unstyled mb-3">
								{% for r in room_reviews %}
								<li class="mb-3 pb-2 border-bottom">
									<div class="d-flex justify-content-between align-items-start">
										<div>
											<strong>{{ r.name }}</strong> 
											<span class="text-warning ms-2">{{ '‚òÖ' * (r.rating|int) }}</span>
										</div>
										<div class="small text-muted">{{ r.get('date') or '' }}</div>
									</div>
									<div class="small text-muted mt-1">{{ r.comment }}</div>
									{% if r.get('image') %}
									<div class="mt-2 position-relative d-inline-block">
										<img src="/static/uploads/{{ r.image }}" alt="Review image" class="img-fluid rounded" style="max-width: 250px; max-height: 250px;">
										<form method="POST" action="{{ url_for('delete_review_image', room_id=room.id, review_index=loop.index0) }}" style="display: inline;">
											<button type="submit" class="btn btn-sm btn-danger position-absolute" style="top: 5px; right: 5px;" title="‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" onclick="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ?');">
												‚úï
											</button>
										</form>
									</div>
									{% endif %}
								</li>
								{% endfor %}
							</ul>
						{% else %}
							<p class="small text-muted mb-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</p>
						{% endif %}

						<form method="POST" action="{{ url_for('add_review', room_id=room.id) }}" enctype="multipart/form-data">
							<div class="mb-2">
								<input type="text" class="form-control" name="review_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
							</div>
							<div class="mb-2 d-flex gap-2 align-items-center">
								<label class="mb-0">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</label>
								<select name="rating" class="form-select w-auto">
									{% for i in range(5,0,-1) %}
									<option value="{{ i }}">{{ i }} ‚òÖ</option>
									{% endfor %}
								</select>
							</div>
							<div class="mb-2">
								<textarea name="comment" class="form-control" rows="2" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>
							</div>
							<div class="mb-2">
								<label for="review_image" class="form-label">üì∑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
								<input type="file" class="form-control" id="review_image" name="review_image" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" onchange="previewImage(event)">
								<small class="text-muted d-block mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: PNG, JPG, JPEG, GIF, WEBP (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 MB)</small>
							</div>
							<div id="preview-container" class="mb-2" style="display: none;">
								<img id="preview-image" alt="Preview" class="img-fluid rounded" style="max-width: 200px; max-height: 200px;">
								<button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="clearImagePreview()">‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
							</div>
							<div class="d-flex gap-2">
								<button class="btn btn-outline-primary btn-sm" type="submit">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
								<a href="#" class="btn btn-outline-secondary btn-sm" onclick="this.closest('form').reset();clearImagePreview();return false;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
							</div>
						</form>
					</div>
			</div>
		</div>
	</main>

	<script>
		function previewImage(event) {
			const file = event.target.files[0];
			const preview = document.getElementById('preview-image');
			const container = document.getElementById('preview-container');
			
			if (file) {
				const reader = new FileReader();
				reader.onload = function(e) {
					preview.src = e.target.result;
					container.style.display = 'block';
				};
				reader.readAsDataURL(file);
			}
		}
		
		function clearImagePreview() {
			document.getElementById('review_image').value = '';
			document.getElementById('preview-container').style.display = 'none';
		}
	</script>
{% endblock %}
