{% extends 'base.html' %}

{% block title %}‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ - Admin{% endblock %}

{% block content %}
<div class="container-fluid my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
    <div class="d-flex gap-2">
      <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary btn-sm">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö Admin</a>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">Logout</a>
    </div>
  </div>

  <!-- Customer Summary -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card p-3 text-center">
        <h4 class="text-primary">{{ bookings|length }}</h4>
        <p class="mb-0 text-muted">üé´ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3 text-center">
        <h4 class="text-success">{{ customer_summary|length }}</h4>
        <p class="mb-0 text-muted">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3 text-center">
        <h4 class="text-info">‡∏ø{{ '%.2f'|format(bookings|sum(attribute='total_price')) }}</h4>
        <p class="mb-0 text-muted">üí∞ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card p-3 text-center">
        <h4 class="text-warning">{{ bookings|sum(attribute='nights') }}</h4>
        <p class="mb-0 text-muted">üåô ‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
    </div>
  </div>

  <!-- Customer Bookings Table -->
  <div class="card p-4">
    <h4 class="mb-3">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h4>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th>‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</th>
            <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</th>
            <th>‡∏Ñ‡∏∑‡∏ô</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Ñ‡∏∑‡∏ô</th>
            <th>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</th>
            <th>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏ß‡∏±‡∏ô‡∏à‡∏≠‡∏á</th>
          </tr>
        </thead>
        <tbody>
          {% for booking in bookings %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <strong>{{ booking.customer_name }}</strong>
            </td>
            <td>
              <small class="text-muted">{{ booking.customer_email }}</small>
            </td>
            <td>
              <span class="badge bg-info text-dark">{{ booking.room_name }}</span>
            </td>
            <td>
              <small>{{ booking.check_in|format_date }} ‚Üí {{ booking.check_out|format_date }}</small>
            </td>
            <td>
              <strong>{{ booking.nights }}</strong>
            </td>
            <td>
              ‡∏ø{{ '%.2f'|format(booking.price_per_night) }}
            </td>
            <td>
              <strong class="text-success">‡∏ø{{ '%.2f'|format(booking.total_price) }}</strong>
            </td>
            <td>
              üë• {{ booking.guests }}
            </td>
            <td>
              {% if booking.status == 'completed' %}
                <span class="badge bg-success">‚úì ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
              {% elif booking.status == 'pending' %}
                <span class="badge bg-warning text-dark">‚è≥ ‡∏£‡∏≠</span>
              {% else %}
                <span class="badge bg-danger">‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
              {% endif %}
            </td>
            <td>
              <small class="text-muted">{{ booking.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="11" class="text-center text-muted py-4">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Customer Summary Table -->
  {% if customer_summary %}
  <div class="card p-4 mt-4">
    <h4 class="mb-3">üë• ‡∏™‡∏£‡∏∏‡∏õ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h4>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</th>
            <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô</th>
          </tr>
        </thead>
        <tbody>
          {% for email, customer in customer_summary.items() %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ customer.name }}</td>
            <td><small class="text-muted">{{ customer.email }}</small></td>
            <td>
              <span class="badge bg-primary">{{ customer.count }}</span>
            </td>
            <td>
              <strong class="text-success">‡∏ø{{ '%.2f'|format(customer.total_spent) }}</strong>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
